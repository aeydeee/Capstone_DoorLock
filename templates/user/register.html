{% extends 'base.html' %}

{% block content %}
    {% for message in get_flashed_messages() %}
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}

    <h1>REGISTRATION: </h1>
    <div class="shadow p-3 mb-5 bg-body-tertiary rounded">
        <form method="POST" enctype="multipart/form-data" action="{{ url_for('auth.register') }}">
            {{ form.hidden_tag() }}

            <h2>User Information</h2>
            {% for field in form if field.name not in ['contact_number', 'h_city', 'h_barangay', 'h_house_no', 'h_street', 'curr_city', 'curr_barangay', 'curr_house_no', 'curr_street', 'elem_school', 'elem_address', 'elem_graduated', 'junior_school', 'junior_address', 'junior_graduated', 'senior_school', 'senior_address', 'senior_graduated', 'senior_track_strand', 'mother_full_name', 'mother_educ_attainment', 'mother_addr', 'mother_brgy', 'mother_cont_no', 'father_full_name', 'father_educ_attainment', 'father_addr', 'father_brgy', 'father_cont_no', 'guardian_full_name', 'guardian_educ_attainment', 'guardian_addr', 'guardian_brgy', 'guardian_cont_no', 'student_number', 'course_name', 'year_level', 'section', 'faculty_id', 'faculty_department', 'admin_department', 'csrf_token', 'submit', 'school_id', 'password', 'password2', 'designation'] %}
                <div class="form-group">
                    {{ field.label(class="form-control-label") }}
                    {{ field(class="form-control" + (" is-invalid" if field.errors else "")) }}
                    {% for error in field.errors %}
                        <div class="invalid-feedback">
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}

            <div id="password-fields">
                <div class="form-group">
                    {{ form.password.label(class="form-control-label") }}
                    {{ form.password(class="form-control" + (" is-invalid" if form.password.errors else "")) }}
                    {% for error in form.password.errors %}
                        <div class="invalid-feedback">
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>
                <div class="form-group">
                    {{ form.password2.label(class="form-control-label") }}
                    {{ form.password2(class="form-control" + (" is-invalid" if form.password2.errors else "")) }}
                    {% for error in form.password2.errors %}
                        <div class="invalid-feedback">
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>
            </div>

            <h2>Contact Information</h2>
            {% for field in [form.contact_number, form.h_city, form.h_barangay, form.h_house_no, form.h_street, form.curr_city, form.curr_barangay, form.curr_house_no, form.curr_street] %}
                <div class="form-group">
                    {{ field.label(class="form-control-label") }}
                    {{ field(class="form-control" + (" is-invalid" if field.errors else "")) }}
                    {% for error in field.errors %}
                        <div class="invalid-feedback">
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}

            <h2>Educational Background</h2>
            {% for field in [form.elem_school, form.elem_address, form.elem_graduated, form.junior_school, form.junior_address, form.junior_graduated, form.senior_school, form.senior_address, form.senior_graduated, form.senior_track_strand] %}
                <div class="form-group">
                    {{ field.label(class="form-control-label") }}
                    {{ field(class="form-control" + (" is-invalid" if field.errors else "")) }}
                    {% for error in field.errors %}
                        <div class="invalid-feedback">
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}

            <h2>Family Background</h2>
            {% for field in [form.mother_full_name, form.mother_educ_attainment, form.mother_addr, form.mother_brgy, form.mother_cont_no, form.father_full_name, form.father_educ_attainment, form.father_addr, form.father_brgy, form.father_cont_no, form.guardian_full_name, form.guardian_educ_attainment, form.guardian_addr, form.guardian_brgy, form.guardian_cont_no] %}
                <div class="form-group">
                    {{ field.label(class="form-control-label") }}
                    {{ field(class="form-control" + (" is-invalid" if field.errors else "")) }}
                    {% for error in field.errors %}
                        <div class="invalid-feedback">
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}

            <h2>Role-Specific Information</h2>
            <div id="student-fields" class="role-specific-fields" style="display: none;">
                {% for field in [form.student_number, form.course_name, form.year_level, form.section] %}
                    <div class="form-group">
                        {{ field.label(class="form-control-label") }}
                        {{ field(class="form-control" + (" is-invalid" if field.errors else "")) }}
                        {% for error in field.errors %}
                            <div class="invalid-feedback">
                                {{ error }}
                            </div>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
            <div id="faculty-fields" class="role-specific-fields" style="display: none;">
                {% for field in [form.faculty_id, form.faculty_department, form.designation] %}
                    <div class="form-group">
                        {{ field.label(class="form-control-label") }}
                        {{ field(class="form-control" + (" is-invalid" if field.errors else "")) }}
                        {% for error in field.errors %}
                            <div class="invalid-feedback">
                                {{ error }}
                            </div>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
            <div id="admin-fields" class="role-specific-fields" style="display: none;">
                {% for field in [form.admin_department, form.school_id] %}
                    <div class="form-group">
                        {{ field.label(class="form-control-label") }}
                        {{ field(class="form-control" + (" is-invalid" if field.errors else "")) }}
                        {% for error in field.errors %}
                            <div class="invalid-feedback">
                                {{ error }}
                            </div>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>

            <button type="submit" class="btn btn-primary">Register</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const roleField = document.getElementById('{{ form.role.id }}');
            const studentFields = document.getElementById('student-fields');
            const facultyFields = document.getElementById('faculty-fields');
            const adminFields = document.getElementById('admin-fields');
            const passwordFields = document.getElementById('password-fields');

            function toggleRoleFields() {
                const role = roleField.value;
                studentFields.style.display = role === 'student' ? 'block' : 'none';
                facultyFields.style.display = role === 'faculty' ? 'block' : 'none';
                adminFields.style.display = role === 'admin' ? 'block' : 'none';
                passwordFields.style.display = role === 'student' ? 'none' : 'block';
            }

            roleField.addEventListener('change', toggleRoleFields);
            toggleRoleFields();  // Initial call to set correct display
        });
    </script>
{% endblock %}
